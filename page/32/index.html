<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta name="baidu-site-verification" content="codeva-Ss7c9LFzfb" />
<meta name="bytedance-verification-code" content="GHbi5zMz8c6TSVpY9rLD" />







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="some program,some life,some code, and some linux">
<meta property="og:type" content="website">
<meta property="og:title" content="Resive world">
<meta property="og:url" content="https://www.resonanat.com/page/32/index.html">
<meta property="og:site_name" content="Resive world">
<meta property="og:description" content="some program,some life,some code, and some linux">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Companyd">
<meta property="article:tag" content="ubuntu linux java elasitesearch">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.resonanat.com/page/32/"/>



<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4636539228226058"
     crossorigin="anonymous"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-67H9TCZZ7N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-67H9TCZZ7N');
</script>


  <title>Resive world - Come world to Record life</title>
  








<meta name="generator" content="Hexo 7.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Resive world</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Come world to Record life</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/19/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%B7%9D%E7%A6%BB%E6%B5%8B%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/19/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%B7%9D%E7%A6%BB%E6%B5%8B%E5%BA%A6/" itemprop="url">常见的距离测度</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-19T12:56:04+00:00">
                2016-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Mining/" itemprop="url" rel="index">
                    <span itemprop="name">Data Mining</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在对向量进行相似度计算的时候经常需要纠结的是用什么测度来衡量相似度。经常听到的距离测度无非是欧氏距离、曼哈顿距离、切比雪夫距离、闵科夫斯基距离、海明距离、编辑距离、余弦距离、杰卡德距离这么几个，稍微生僻点的再加上什么标准化欧氏距离、卡方距离、马哈拉诺比斯距离、巴塔恰里雅距离、皮尔逊距离。前面说的那些距离大都是一回事，掌握了初中左右的知识基本都能理解，而后面说的这些距离就相对复杂很多了，得有离散统计线性代数这类的扎实功底才能吃透。。。这里就稍微介绍下概念上距离测度的定义，以及简单的距离测度。</p>
<h2 id="距离测度的定义"><a href="#距离测度的定义" class="headerlink" title="距离测度的定义"></a>距离测度的定义</h2><p>感觉实距离测度本没有标准的定义，只是人们用多了，也就有了这么个定义。</p>
<p>所谓距离测度(Similarity Measure)就是指一个函数$d(x,y)$，用空间中的两个点$x,y$作为参数，输出一个实数值，这个值能够反应这两个点的距离关系。这个函数一般要满足下面的准则：</p>
<p>1、$d(x,y)\geq 0$（非负性）</p>
<p>2、$x&#x3D;y$当且仅当$d(x,y)&#x3D;0$（自反性）</p>
<p>3、$d(x,y)&#x3D;d(y,x)$（对称性）</p>
<p>4、$d(x,y)\geq d(x,z)+d(z,y)$(三角不等式)</p>
<p>前三个都很好理解，只是为什么一定要满足三角不等式呢？我想应该是为了保证距离一定得是所有同类路径中最短的那条轨迹。</p>
<h2 id="闵可夫斯基距离类"><a href="#闵可夫斯基距离类" class="headerlink" title="闵可夫斯基距离类"></a>闵可夫斯基距离类</h2><p>在n维空间中，两个n维向量$x&#x3D;(x_1,x_2,x_3,…,x_n),y&#x3D;(y_1,y_2,y_3,…,y_n)$之间的<strong>闵可夫斯基距离</strong>(Minkowski <wbr />Distance)定义为：</p>
<p>$$d(x,y)&#x3D;(\overset{n}{\underset{i&#x3D;1}{\sum}}|x_i-y_i|^p)^{\frac 1p}$$</p>
<p>闵科夫斯基距离实际上就是Lp norm里的距离(p根据需要确定)。可以很容易的证明当p&gt;&#x3D;1的时候，这个距离都是满足距离测度的定义的。不过当$p&lt;0$时，他就不满足三角不等式了，也就不算是标准的距离测度了。</p>
<p>当$p&#x3D;1$时，闵科夫斯基距离就变<strong>曼哈顿距离</strong>成了：</p>
<p>$$d(x,y)&#x3D;\overset{n}{\underset{i&#x3D;1}{\sum}}|x_i-y_i|$$</p>
<p>曼哈顿距离，又叫出租车距离，直观的理解就是向量在各个维度上差的绝对值之和。</p>
<p>当$p&#x3D;2$时，就是我们最常见的<strong>欧氏距离</strong>了：</p>
<p>$$d(x,y)&#x3D;(\overset{n}{\underset{i&#x3D;1}{\sum}}(x_i-y_i)^2)^{\frac 12}$$</p>
<p>当$p\to\infty$时，闵科夫斯基距离就变成了<strong>切比雪夫距离</strong>：</p>
<p>$$d(x,y)&#x3D;MAX(|x_i-y_i|)$$</p>
<p>也就是向量在各个维度上差的绝对值的最大值。</p>
<p>可以很容易证明，当$p\geq 1$时，闵科夫斯基距离是满足距离测度的所有要求的。</p>
<h2 id="海明距离"><a href="#海明距离" class="headerlink" title="海明距离"></a>海明距离</h2><p>海明距离的定义也很简单，对于两个向量，他们之间的海明距离就是定义为这两个向量中不同分量的个数。仔细想想这个距离定义好像很没有用，不过事实上他通常应用在布尔向量(比如00101和01111的海明距离就是2)或者相似度要求比较高的场景中。</p>
<p>他的特点在于计算速度巨快，通过计算机基础的异或操作就能比较布尔向量的距离，因此在数据量巨大、追求效率的场景中用处还是非常广的。</p>
<h2 id="编辑距离"><a href="#编辑距离" class="headerlink" title="编辑距离"></a>编辑距离</h2><p>编辑距离也是很简单的，主要用于两个字符串之间的距离计算。定义就是将一个字符串用最少的删除、插入操作变成另一个字符串所需要的操作个数。比如$x&#x3D;abcde,y&#x3D;acfdeg$，他们的编辑距离就是3。具体的实现方法就用$dp$做就好了，复杂度就是两个字符串长度之积。他的值跟这两个字符串的LCS还有一定的关系，即编辑距离等于x和y的长度之和减去他们LCS长度的两倍。</p>
<p>当然，有些定义的编辑距离还会支持“替换”或者“交换”之类的操作，其实意思也都差不多了。</p>
<h2 id="余弦距离"><a href="#余弦距离" class="headerlink" title="余弦距离"></a>余弦距离</h2><p>余弦距离就是字面上的意思了，也就是求两个向量夹角的余弦值。具体的计算方法也就是用两个向量的内积除以两个向量的$l_2\ \ norm$：</p>
<p>$$d(x,y)&#x3D;\frac{\sum x_iy_i}{(\sum(x_i-y_i)^2)^{\frac 12}}$$</p>
<p>余弦距离在某些情况下特别管用，谁用谁知道。</p>
<h2 id="杰卡德距离"><a href="#杰卡德距离" class="headerlink" title="杰卡德距离"></a>杰卡德距离</h2><p>Jaccard距离实际上就是1-Jaccard相似度，即：</p>
<p>$$d(x,y)&#x3D;1-SIM(x,y)$$</p>
<p>在文档相似度处理时，杰卡德距离和杰卡德相似度都常常被提及。</p>
<p>上面这些距离测度其实都很好理解，在这里归纳一下主要是为了以后遇到类似距离计算的问题时能够多几种思考的角度。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/18/%E9%9D%A2%E5%90%91%E6%9C%80%E5%B0%8F%E5%93%88%E5%B8%8C%E7%AD%BE%E5%90%8D%E7%9A%84LSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/18/%E9%9D%A2%E5%90%91%E6%9C%80%E5%B0%8F%E5%93%88%E5%B8%8C%E7%AD%BE%E5%90%8D%E7%9A%84LSH/" itemprop="url">面向最小哈希签名的LSH</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-18T11:37:55+00:00">
                2016-09-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Mining/" itemprop="url" rel="index">
                    <span itemprop="name">Data Mining</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="LSH"><a href="#LSH" class="headerlink" title="LSH"></a>LSH</h2><p>我们知道<a href="/2016/09/17/1/">最小哈希签名</a>能够把一篇较大的文档压缩成一个较短的签名并且不影响文档间的Jaccard相似度。很多情况下，我们用最小哈希签名的目的就是为了方便的对文档进行存储，并且对于给定的文档，能在大量的文档中快速的查找相似的文章。现在我们能做到快速的对两篇文章进行相似度比较，但是当总的文档数目比较大的时候，比较所有文档的最小哈希签名仍然是一个非常耗时耗力的事。而我们知道，对于给定的文档而言，文档库中的绝大多数文档其实都没有比较的意义，如果能有一个方法能过滤掉不需要比较的大量文档，那么显然就能加快整个查找的过程。这个思路其实可以称为”Filter and Refine”，”先过滤，后提纯”。而实现这个的方法，就是LSH(Locality-Sensitive Hashing 局部敏感哈希)。</p>
<p>现在先不精确定义LSH，只要知道LSH是一种对大量数据进行过滤的方法即可。</p>
<h2 id="面向最小哈希签名的LSH"><a href="#面向最小哈希签名的LSH" class="headerlink" title="面向最小哈希签名的LSH"></a>面向最小哈希签名的LSH</h2><p>对于最小哈希签名来说，我们可以通过一种叫“行条化策略”的方法，对最小哈希签名再进行一次哈希。怎么做呢？</p>
<p>对于$n$个长度为$k$的最小哈希签名的集合$S_1,S_2,S_3,…,S_n$、以及生成他们的的$k$个哈希函数来说，我们用下面的签名矩阵来表示他们：<br>$$<br>\begin{matrix}&amp;S_1&amp;S_2&amp;S_3&amp;…&amp;S_n\\h_1&amp;x&amp;x&amp;x&amp;x&amp;x\\h_2&amp;x&amp;x&amp;x&amp;x&amp;x\\h_3&amp;x&amp;x&amp;x&amp;x&amp;x\\…&amp;x&amp;x&amp;x&amp;x&amp;x\\h_k&amp;x&amp;x&amp;x&amp;x&amp;x\\\end{matrix}<br>$$</p>
<p>其中一列就表示一个最小哈希签名。</p>
<p>接着，我们把这个矩阵平均划分成$b$个行条，每个行条有$r$行(显然$r*b&#x3D;k$)。这相当于我们把每一个签名分成了$b$段，每一段有$r$个数。然后我们再分别对每一段进行一次哈希，将该段相同的哈希签名放在一个桶中，该段不同的放在不同的桶中(当然，不同行条的桶互不影响）。这就相当于把一个长度为$k$的最小哈希签名映射到了$b$个桶中。</p>
<p>这样一来，我们如果我们需要对某个最小哈希签名进行相似查找，我们只要对这$b$个桶中的那些东西进行比较即可，省去了很多不必要的比较。</p>
<h2 id="行条化策略分析"><a href="#行条化策略分析" class="headerlink" title="行条化策略分析"></a>行条化策略分析</h2><p>那么用行条化策略后会不会影响我们查询的准确性呢？答案是—当然会。</p>
<p>所谓影响正确性，无非就两种，一种是伪正例(false positive)，一种是伪反例(false negative)。</p>
<p>所谓伪正例，就是指我们把不相似的签名加到了进一步比较的列表中。对于伪正例而言，我们显然不用担心，因为下一步直接比较的目的就是去除伪正例，只是会害我们多比较几次，因此我们主要关注的是伪反例。</p>
<p>所谓伪反例，就是指我们把相似度很高的签名给漏掉了。这就很尴尬了，因为漏掉的话以后就再也不会考虑到他了。这是我们需要极力避免的。</p>
<p>那么伪反例的比例到底是怎么样的呢？</p>
<p>我们知道在两个签名的Jaccard相似度为$s$的情况下，这两个签名的某一个位相等的概率就是$s$，那么在某一行相等的概率就是$s^r$，那么在任意一行都不相等的概率就是$(1-s^r)^b$，那么他们最终成为候选对的概率就是$(1-(1-s^r)^b)$。也就是说两个签名最终会被放在一起作为进行比较的概率$P&#x3D;1-(1-s^r)^b$。</p>
<p>也就是说，对于给定的$s\ r\ b$，伪反例的比例就是$1-P$。假设$s&#x3D;0.8,b&#x3D;20,r&#x3D;5$，这时伪反例的比例就是0.000356，还是相当低的，而且随着b的增大，这个值还会变得更小。</p>
<p>接下来我们就分析以下如何根据我们需要的$s$来确定参数$r,b$。不管$r,b$的取值是什么，$P$关于$s$的函数图像基本是这样的：</p>
<p><img src="/images/2016/09/18/1/1.png"></p>
<p>注意到$s$的取值在0到1之间，这个函数图像和sigmoid还是有点像的，虽然突变的部分不是很明显，但是还是两端的差距还是很明显的。通过调节这个函数的参数，我们就可以控制只把相似度大于一定阈值$s_{thresh}$的签名以很高的概率纳为候选对，而相似度低的签名以很低的概率不纳为候选对。通常情况下我们会通过调节$r,b$，使这个阈值$s_{thresh}$对应到概率为0.5的地方，这个时候就有$s_{thresh}&#x3D;(1-2^{-\frac 1b})^{\frac 1r}$。不过有时候为了方便，也为了更准确，这个$s_{thresh}$会设置为$(\frac 1b)^{\frac 1r}$。当$s&#x3D;(\frac 1b)^{\frac 1r}$时，我们可以算出来，概率$Q&#x3D;1-(1-\frac 1b)^b$。显然$\underset{b\to \infty}{Q}\to 1-\frac1e\approx 0.632$。也就是说这个值会比0.5稍大，不过实际上效果可能更好。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/17/%E6%9C%80%E5%B0%8F%E5%93%88%E5%B8%8C%E7%AD%BE%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/17/%E6%9C%80%E5%B0%8F%E5%93%88%E5%B8%8C%E7%AD%BE%E5%90%8D/" itemprop="url">最小哈希签名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-17T04:02:22+00:00">
                2016-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Mining/" itemprop="url" rel="index">
                    <span itemprop="name">Data Mining</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最小哈希签名(minhashing signature)解决的问题是，如何用一个哈希方法来对一个集合（集合大小为n）中的子集进行保留相似度的映射（使他在内存中占用的字节数尽可能的少）。</p>
<p>其实哈希本身并不算难，难的是怎么保留两个子集的相似度的信息。所谓保留相似度，就是说我们能十分直观的从两个子集的哈希结果中看出他们的相似度。当然，朴素的办法就用是一个长度为n的二进制数的每个位来分别对应集合中的每个元素。不过当n比较大而待hash的集合的数目比较小的时候，这种方法的效率就太低了。这时候最常用的方法就是对集合进行最小哈希。</p>
<h2 id="最小哈希"><a href="#最小哈希" class="headerlink" title="最小哈希"></a>最小哈希</h2><p>什么叫最小哈希，我的理解是，一个很大的集合进行哈希处理的过程其实是由很多小的哈希过程组成。而这些最小的哈希过程就被称为是最小哈希。最小哈希的具体内容就是把一个集合映射到一个编号上。具体的过程也很简单了。</p>
<p>比如对于集合$U&#x3D;\{a,b,c,d,e\},S_1:\{a,d\},S_2:\{c\},S_3:\{b,d,e\},S_4:\{a,c,d\}$，我们用一个矩阵形式来表示他们：</p>
<p>$$\begin{matrix}No.&amp;Item&amp;S_1&amp;S_2&amp;S_3&amp;S_4\\0&amp;a&amp;1&amp;0&amp;0&amp;1\\1&amp;b&amp;0&amp;0&amp;1&amp;0\\2&amp;c&amp;0&amp;1&amp;0&amp;1\\3&amp;d&amp;1&amp;0&amp;1&amp;1\\4&amp;e&amp;0&amp;0&amp;1&amp;0\\\end{matrix}$$</p>
<p>那么，对他进行一次最小哈希就是在经过随机的行排列之后，对于每个集合，从上到下取第一个数值为1的那一行的行号。</p>
<p>比如对上面的矩阵进行随机行排列后变成：</p>
<p>$$\begin{matrix}No.&amp;Item&amp;S_1&amp;S_2&amp;S_3&amp;S_4\\1&amp;b&amp;0&amp;0&amp;1&amp;0\\4&amp;e&amp;0&amp;0&amp;1&amp;0\\0&amp;a&amp;1&amp;0&amp;0&amp;1\\3&amp;d&amp;1&amp;0&amp;1&amp;1\\2&amp;c&amp;0&amp;1&amp;0&amp;1\\\end{matrix}$$</p>
<p>那么每个集合的minhash结果就应该是$h(S_1)&#x3D;0,h(S_2)&#x3D;2,h(S_3)&#x3D;1,h(S_4)&#x3D;0$。</p>
<p>这就是minhash的基本方法。</p>
<h2 id="最小哈希签名"><a href="#最小哈希签名" class="headerlink" title="最小哈希签名"></a>最小哈希签名</h2><p>在最小哈希的基础上，最小哈希签名也就很简单了。在最小哈希中，需要对每行进行随机行排列，如果是真随机排列的话显然计算消耗会特别大。因此实际上我们采用了一个替代方法，就是再用一个哈希函数，将行号进行哈希变换。比如当n&#x3D;5时，对$0,1,2,3,4$这5个数，可以用$h(x)&#x3D;(3x+1)%5$的方法进行映射，得到$1,4,2,0,3$。当然，随便找的$h(x)&#x3D;ax+b$这种哈希函数显然可能会冲突，不过只要n和a互素，那么生成的一定是一个排列，这一点用同余类的知识很好证明。</p>
<p>不过显然，一次最小哈希的结果不能全面的表现出集合的特征。因此最小哈希签名采用了k个不同的哈希函数$h_1,h_2,h_3,…,h_k$，对于集合S，分别调用这些函数作为最小哈希的排列函数，构建出集合S的最小哈希签名$[h_1(S),h_2(S),h_3(S),…,h_k(S)]$。显然，这个签名所占的空间要远远小于用朴素的方法保存集合所需的空间。</p>
<h2 id="保留相似度的哈希"><a href="#保留相似度的哈希" class="headerlink" title="保留相似度的哈希"></a>保留相似度的哈希</h2><p>为什么说这个最小哈希签名是一种保留相似度的哈希呢？其实也很好理解。</p>
<p>事实上，对于两个集合$S_1,S_2$来说，我们知道在前面的矩阵的所有行中，他们的值同时为1的行有$|S_1\cap S_2|$个；一个是1一个是0的行有$|S_1\cup S_2|-|S_1 \cap S_2|$个。那么在对行进行随机排列之后，从上往下数同时为1的行比一个为1一个为0的行先出现的概率就是$\frac{|S_1\cap S_2|}{|S_1\cup S_2|}$。而这恰巧就是两个集合的Jaccard相似度。也就是说在每一次最小哈希的过程中，两个集合的哈希值相等的概率就是两个集合的Jaccard相似度。这个性质就非常棒了，他保证了如果把最小哈希签名生成的向量当成集合，那么对两个集合进行最小哈希签名之后生成的集合之间的Jaccrad相似度的期望值与原集合的Jaccard相似度相等。</p>
<p>这就是所谓的保留相似度的哈希。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/16/%E6%96%87%E6%A1%A3%E5%88%86%E5%89%B2%E7%9A%84shingling%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/16/%E6%96%87%E6%A1%A3%E5%88%86%E5%89%B2%E7%9A%84shingling%E7%AE%97%E6%B3%95/" itemprop="url">文档分割的shingling算法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-16T12:23:38+00:00">
                2016-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Mining/" itemprop="url" rel="index">
                    <span itemprop="name">Data Mining</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>shingling算法是最常见的文档分割算法，说白了就是将一个文档分解成由短字符构成的字符串集合。分割后的文档就可以通过Jaccard相似度等简单的度量标准进行相似度检测了。</p>
<h2 id="k-shingling"><a href="#k-shingling" class="headerlink" title="k-shingling"></a>k-shingling</h2><p>对于任意一篇文档，我们把他当成一个字符串，那么他的k-shingling集合就被定义为文档中所有长度为k的子字符串的集合。比如字符串“abcdabd”，他的2-shingling集合就是{ab,bc,cd,da,bd}。</p>
<p>当然，所有类型的子字符串只会在集合中出现一次。不过实际的文档中可能会有连续的空格、TAB、回车或者标点符号之类的东西，一般可以把他们都变成一个空格来进行处理。</p>
<h2 id="shingle大小的选择"><a href="#shingle大小的选择" class="headerlink" title="shingle大小的选择"></a>shingle大小的选择</h2><p>显然，如果要使用k-shingling来对文档进行处理就要先确定这个k值，一般而言，要确保这个值足够大，保证任意的shingle在文档中出现的概率较低。不过也没有一个具体的选择方法，倒是有一些经验参数，比如对于英文邮件，可以取k&#x3D;5；而对于英文研究论文，可以取k&#x3D;9，因为邮件的长度一般比较低，而论文则相对较高。</p>
<h2 id="一个简单变种"><a href="#一个简单变种" class="headerlink" title="一个简单变种"></a>一个简单变种</h2><p>有一种简单的基于词的shingling方法，能够很有效的区分英文新闻与广告。这个应用在对网页进行查重的时候特别有用，因为网页上除了新闻本身之外，通常还会有不同的广告，干扰我们对相同新闻的判断。具体的做法也很简单，就是把shingle定义成一个停用词(就是”and”、”but”、“you”之类经常出现的词)加上后续的两个单词。这样做是因为广告通常比较精炼而较少包含停用词。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/16/%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%BA%A6%E9%87%8F%E6%A0%87%E5%87%86%E4%B9%8BJaccard%E7%9B%B8%E4%BC%BC%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/16/%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%BA%A6%E9%87%8F%E6%A0%87%E5%87%86%E4%B9%8BJaccard%E7%9B%B8%E4%BC%BC%E5%BA%A6/" itemprop="url">相似度度量标准之Jaccard相似度</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-16T10:19:46+00:00">
                2016-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Mining/" itemprop="url" rel="index">
                    <span itemprop="name">Data Mining</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>Jaccard相似度(杰卡德相似度)是一个用于衡量两个集合相似程度的度量标准，他的定义如下：给定两个集合$S,T$，那么我们记这两个集合的Jaccard相似度$SIM(S,T)$为:<br>$$SIM(S,T)&#x3D;|S\cap T|&#x2F;|S\cup T|$$<br>也就是两个集合交集的大小除以两个集合并集的大小。显然他的取值在[0,1]区间。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>原始的Jaccard相似度定义的仅仅是两个集合(set)之间的相似度，而实际上更常见的情况是我们需要求两个包(bag,multiset)的相似度，即每个元素可能会出现多次。那么在这种情况下，Jaccard相似度的分子就便成了取每个元素在两个包中出现的最小次数之和，分母是两个包中元素的数目之和。比如$\{a,a,a,b\},\{a,a,b,b,c\}$之间的Jaccard相似度就是(2+1)&#x2F;(4+5)&#x3D;33%。</p>
<p>这里分子的设计是很容易理解的，那么为什么分母设计成两个集合中元素数目之和而不是并集(包的并集通常定义为元素的叠加)中的数目之和呢？因为那样会使最大的Jaccard相似度为1&#x2F;2，而不是习惯理解的1。当然，我们也可以把包的并集中的元素数目定义为在两个集合中出现的最大次数，这样的度量标准也比较符合我们的认知习惯。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>Jaccard的应用很广，最常见的应用就是求两个文档的文本相似度，通过一定的办法(比如shinging)对文档进行分词，构成词语的集合，再计算Jaccard相似度即可。当然，用途还有很多，不过大多需要结合其他的技术。</p>
<h2 id="一道习题"><a href="#一道习题" class="headerlink" title="一道习题"></a>一道习题</h2><p>问：假定全集$U$有$n$个元素，随机选择两个子集$S,T$，每个子集都有m个元素，求$S,T$的Jaccard相似度的期望值。</p>
<p>解：显然，若有k个元素重合，那么贡献的Jaccard相似度就是$\frac{k}{2m-k}$，且这个事件出现的概率是$\frac{C^k_mC^{m-k}_{n-m}}{C^m_n}$，因此对这k种可能求和即可：</p>
<p>$Exp(SIM(S,T))&#x3D;\sum^m_{k&#x3D;0}\frac{k}{2m-k}\frac{C^k_mC^{m-k}_{n-m}}{C^m_n}$</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/13/SDL2%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/13/SDL2%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" itemprop="url">SDL2安装指南</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-13T11:31:44+00:00">
                2016-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-C/" itemprop="url" rel="index">
                    <span itemprop="name">C/C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>SDL（Simple DirectMedia Layer）是一套开放源代码的跨平台多媒体开发库，使用C语言写成。SDL提供了数种控制图像、声音、输出入的函数，让开发者只要用相同或是相似的代码就可以开发出跨多个平台（Linux、Windows、Mac OS X等）的应用软件。目前SDL多用于开发游戏、模拟器、媒体播放器等多媒体应用领域。下面主要介绍一下在Windows下搭建SDL2开发环境的过程。</p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>下载自<a target="_blank" rel="noopener" href="http://www.libsdl.org/download-2.0.php">SDL官网</a>，在Development Libraries中选择相应的版本。我这里选择的是Windows平台下的Visual C++版，因为我接下来使用的环境是VS2013。</p>
<p><img src="/images/2016/09/13/1/1.png"></p>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><p>把文件下载下来解压后的文档树应该是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">└─SDL2-2.0.4</span><br><span class="line">    │  BUGS.txt</span><br><span class="line">    │  COPYING.txt</span><br><span class="line">    │  README-SDL.txt</span><br><span class="line">    │  README.txt</span><br><span class="line">    │  WhatsNew.txt</span><br><span class="line">    │</span><br><span class="line">    ├─docs</span><br><span class="line">    │      doxyfile</span><br><span class="line">    │      README-android.md</span><br><span class="line">    │      README-cmake.md</span><br><span class="line">    │      README-directfb.md</span><br><span class="line">    │      ......</span><br><span class="line">    │</span><br><span class="line">    ├─include</span><br><span class="line">    │      begin_code.h</span><br><span class="line">    │      close_code.h</span><br><span class="line">    │      SDL.h</span><br><span class="line">    │      SDL_assert.h</span><br><span class="line">    │      SDL_atomic.h</span><br><span class="line">    │      SDL_audio.h</span><br><span class="line">    │      ......</span><br><span class="line">    │</span><br><span class="line">    └─lib</span><br><span class="line">        ├─x64</span><br><span class="line">        │      SDL2.dll</span><br><span class="line">        │      SDL2.lib</span><br><span class="line">        │      SDL2main.lib</span><br><span class="line">        │      SDL2test.lib</span><br><span class="line">        │</span><br><span class="line">        └─x86</span><br><span class="line">                SDL2.dll</span><br><span class="line">                SDL2.lib</span><br><span class="line">                SDL2main.lib</span><br><span class="line">                SDL2test.lib</span><br></pre></td></tr></table></figure>
<p>主要包含使用说明、doc文档、头文件、以及库文件。这里的库文件包括x86和x64两种架构的，每种都含有一个动态链接库和三个静态链接库。</p>
<h2 id="VS中的项目配置"><a href="#VS中的项目配置" class="headerlink" title="VS中的项目配置"></a>VS中的项目配置</h2><p>SDL2说白了其实只是一个C语言库，因此配置他就跟配置其他任意的库一样，主要分为三步：</p>
<p>一、包含必需的头文件和库文件</p>
<p>因为我们需要能够include进SDL2的头文件，并且找到对应的实现代码(库文件)，所以我们必需得让编译器能够找到他们。因此我们只需要在工程的<code>项目-&gt;属性-&gt;配置属性-&gt;VC++目录&lt;</code> 里配置好相应的路径：</p>
<p><img src="/images/2016/09/13/1/2.png"></p>
<p>也就是修改图中的包含目录以及库目录，分别对应之前的include文件夹，以及lib&#x2F;x86文件夹(VS默认的是x86架构)。</p>
<p>二、添加编译指令</p>
<p>既然用了第三方的库，那么我们在进行编译的时候肯定需要加上-l指令，从而指定编译进去的静态链接库。而按照微软一贯的保姆式作风，在VS中并不需要我们手动输入编译指令，只需要修改一下编译配置，然后就能直接编译了。这个配置在<code>项目-&gt;属性-&gt;配置属性-&gt;链接器-&gt;输入-&gt;附加依赖项&lt;</code> 这里：</p>
<p><img src="/images/2016/09/13/1/3.png"></p>
<p>在这里面加上那三个静态库的名字即可(SDL2.lib、SDL2main.lib、SDL2test.lib)。</p>
<p>三、配置动态库</p>
<p>只配置了静态库已经是可以编译的了，但却是无法调试的，因为程序运行需要SDL2.dll这个动态库的支持。那么我们只需要将SDL2.dll加入电脑的PATH环境变量里或者是工程目录下，从而保证程序能找到他。</p>
<p>最后，针对SDL2还需要额外设置一个配置，就是程序的入口，具体原因不明。配置方法就是修改<code>项目-&gt;属性-&gt;配置属性-&gt;链接器-&gt;系统-&gt;子系统</code>，内容改成”<strong>窗口 (&#x2F;SUBSYSTEM:WINDOWS)</strong>“即可：</p>
<p><img src="/images/2016/09/13/1/4.png"></p>
<p>搞好上面这个配置，理论上就能跑SDL2的程序了，那我就直接把下面这个显示图片的程序作为Hello World来测试一下吧：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SDL.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">SDL_Init</span>(SDL_INIT_EVERYTHING) == <span class="number">-1</span>)&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="built_in">SDL_GetError</span>() &lt;&lt; std::endl;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	SDL_Window *win = <span class="literal">nullptr</span>;</span><br><span class="line">	win = <span class="built_in">SDL_CreateWindow</span>(<span class="string">&quot;Hello World!&quot;</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">640</span>, <span class="number">480</span>, SDL_WINDOW_SHOWN);</span><br><span class="line">	<span class="keyword">if</span> (win == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="built_in">SDL_GetError</span>() &lt;&lt; std::endl;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	SDL_Renderer *ren = <span class="literal">nullptr</span>;</span><br><span class="line">	ren = <span class="built_in">SDL_CreateRenderer</span>(win, <span class="number">-1</span>, SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);</span><br><span class="line">	<span class="keyword">if</span> (ren == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="built_in">SDL_GetError</span>() &lt;&lt; std::endl;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	SDL_Surface *bmp = <span class="literal">nullptr</span>;</span><br><span class="line">	bmp = <span class="built_in">SDL_LoadBMP</span>(<span class="string">&quot;test.bmp&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (bmp == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="built_in">SDL_GetError</span>() &lt;&lt; std::endl;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	SDL_Texture *tex = <span class="literal">nullptr</span>;</span><br><span class="line">	tex = <span class="built_in">SDL_CreateTextureFromSurface</span>(ren, bmp);</span><br><span class="line">	<span class="built_in">SDL_FreeSurface</span>(bmp);</span><br><span class="line">	<span class="built_in">SDL_RenderClear</span>(ren);</span><br><span class="line">	<span class="built_in">SDL_RenderCopy</span>(ren, tex, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">SDL_RenderPresent</span>(ren);</span><br><span class="line">	<span class="built_in">SDL_Delay</span>(<span class="number">2000</span>);</span><br><span class="line">	<span class="built_in">SDL_DestroyTexture</span>(tex);</span><br><span class="line">	<span class="built_in">SDL_DestroyRenderer</span>(ren);</span><br><span class="line">	<span class="built_in">SDL_DestroyWindow</span>(win);</span><br><span class="line">	<span class="built_in">SDL_Quit</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序运行的结果就是显示test.bmp两秒钟。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/12/QR%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%A4%8D%E5%85%A5%E5%9B%BE%E7%89%87%E6%96%B9%E6%B3%95%E7%AE%80%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/12/QR%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%A4%8D%E5%85%A5%E5%9B%BE%E7%89%87%E6%96%B9%E6%B3%95%E7%AE%80%E6%9E%90/" itemprop="url">QR二维码植入图片方法简析</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-12T14:33:13+00:00">
                2016-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Others/" itemprop="url" rel="index">
                    <span itemprop="name">Others</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们平时都经常见到二维码，用手机扫一扫就会显示当中的内容，内容大多是url的格式，方便人们访问站点。不过对于人来说，直接看二维码却并没有任何良好的印象。因此很多商家为了让自家的二维码更加形象，会想方设法地让自家的二维码更加形象生动，于是也就诞生出了很多种图像植入的方法。今天就把这些方法稍微汇总一下。</p>
<h2 id="二维码"><a href="#二维码" class="headerlink" title="二维码"></a>二维码</h2><p>二维码可以说是现今人们生活中经常接触到的东西，简单的讲其实就是把条形码中的竖线变成点，从而增加一个数据维度，达到增加数据内容的目的。事实上二维码的种类有很多，曾经流行的二维码规范大概有下面这几种：</p>
<p><img src="/images/2016/09/12/1/1.png"></p>
<p>不过，最终一直流行到现在的二维码规范就剩下一个日本公司率先搞出来的<strong>QR二维码</strong>(Quick Response)了。QR二维码最典型的特征就是在图片的三个角有三个定位用的正方形，信息容量大、定位方便、数据保密和恢复能力强。有个日本的网站简要介绍了他的构造，连接在<a target="_blank" rel="noopener" href="http://www.swetake.com/qrcode/qr1_en.html">这里</a>。接下来的说明主要是围绕这种二维码进行的讨论。</p>
<h2 id="直接插入图片"><a href="#直接插入图片" class="headerlink" title="直接插入图片"></a>直接插入图片</h2><p>直接插入图片的方法就是在二维码的中间插入设计好的图片，比如下面这些：<br><img src="/images/2016/09/12/1/2.png"></p>
<p>这样插入的图片比较清楚，显然会使人们对二维码的辨识度变高很多，也更容易被人们接受。但是这中插入图片的方法完全是利用了二维码本身的容错处理，或多或少的影响了二维码本身的容错性，原则上是不安全的方法。</p>
<h2 id="修改点阵形状"><a href="#修改点阵形状" class="headerlink" title="修改点阵形状"></a>修改点阵形状</h2><p>所谓修改点阵形状，就是用类似设计师的眼光看待这个二维码，把原本的黑点和白点进行艺术化的修饰。这种方法虽然很难添加自己想要的图片，但是却十分具有艺术美感，让人印象深刻。也可以适当结合插入图片的方法，更加具有表现力。</p>
<p><img src="/images/2016/09/12/1/3.png"><br><img src="/images/2016/09/12/1/4.png"><br><img src="/images/2016/09/12/1/5.png"><br><img src="/images/2016/09/12/1/6.png"><br><img src="/images/2016/09/12/1/7.png"><br><img src="/images/2016/09/12/1/8.png"></p>
<p>当然，这种方法会增加扫码器识别的难度，万一图像做的过火了，简陋的扫码器扫描不出来就很尴尬了。</p>
<h2 id="增加背景图案"><a href="#增加背景图案" class="headerlink" title="增加背景图案"></a>增加背景图案</h2><p>简而言之就是为二维码增加背景，不过随之而来的问题跟上面一样，就是如何能让普通的扫码器快速识别出来。作为几年前百度内部hacthon的优胜项目，百度的工程师对点阵图案也做了一些处理，使二维码能呈现这样的图案：<br><img src="/images/2016/09/12/1/9.png"></p>
<p>基本想法就是把二维码的每个点变小，中间漏出的空隙就用来呈现背景图案。对于某些特定的背景而言，呈现的效果还是很不错的，而且识别起来也相对准确一点。不过对图片的要求也比较高，否则可能会干扰图像的识别。</p>
<p>与这个方法效果看上取类似的还有一种生成方法，这种方法也结合了下面的修改编码的算法，而且已经发表在<a target="_blank" rel="noopener" href="http://link.springer.com/article/10.1007/s00371-015-1107-x#Sec7">springer</a>里，他能够呈现这样的效果：</p>
<p><img src="/images/2016/09/12/1/10.png"></p>
<p>看上去和百度的差不多，不过其实技术含量要高出不知道多少倍。。。</p>
<h2 id="修改编码算法"><a href="#修改编码算法" class="headerlink" title="修改编码算法"></a>修改编码算法</h2><p>上述的方法都或多或少的影响了图像本身的识别能力，虽然看上去效果不错，但是都会或多或少的影响扫码器的识别。而下面的方法能够利用一定的编码技术和小技巧将一个二值图嵌入到二维码中，完全不影响二维码的识别。虽然显示的图像有点抽象，但是拿出来装逼还是很能够体现出技术含量的。</p>
<p><img src="/images/2016/09/12/1/11.png"><br><img src="/images/2016/09/12/1/12.png"><br><img src="/images/2016/09/12/1/13.png"><br><img src="/images/2016/09/12/1/14.png"></p>
<p>上面这些图案的生成其实还是十分繁琐的，需要深入了解QR二维码的实现以及RS编码的特征的编码人员才能真正实现出将二值图和二维码进行融合的算法。</p>
<p>讲述算法的原理的原文在<a target="_blank" rel="noopener" href="http://research.swtch.com/qart">这里</a>，有个简单(蹩脚)的中文翻译版本在<a target="_blank" rel="noopener" href="http://blog.csdn.net/yanlaizhishi/article/details/8522722">这里</a>，他们实现的程序发布在了<a target="_blank" rel="noopener" href="http://research.swtch.com/qr/draw">这里</a>(不知道怎么回事时而登的上时而登不上)。</p>
<p>下面就简要介绍一下这个算法的基本思想。</p>
<p>首先我们要稍微了解一下QR二维码的基本构造。QR二维码的一个经典构造就是下面的这张图：</p>
<p><img src="/images/2016/09/12/1/15.png"></p>
<p>简单区分下就是有三类东西，一类是类似小正方形的东西和图中那些黑白相间的条纹，他们主要是用来帮助扫码器定位用的的，所有的QR二维码都具有的部分；还有一类就是格式信息的控制部分，他们就像是配置文件一样，定义了这张二维码的基本信息格式，是必不可少的，主要分布在定位符旁边，毕竟他们是不容许出错的；最后一类就是数据了，当然是经过编码的数据，按照一定的排列规则填充在剩下的空间里，具有一定的容错能力。</p>
<p>很显然数据是以二进制串的形式存储在图里的，也就是黑点和白点了。一张固定大小的图能保存的数据量显然也是固定的，QR二维码也定义了数据的终止符，也就是说当我们的数据写完之后，写上终止符，编码程序会自动在后面加上一些无用的数据(其实是一个循环的数据串)，使得总长度等于最大数据量。这些数据按照下面的顺序写入二维码中：</p>
<p><img src="/images/2016/09/12/1/16.png"></p>
<p>或者换一张图就是这样：</p>
<p><img src="/images/2016/09/12/1/17.png"></p>
<p>不过如果直接将这个数据就这么显示出来，那么对于只需要保存少量信息的二维码来说，很大的空间都是相同的内容(就是用来填充的字符串)，这样显然不美观。因此在把数据写进去之后，我们还会对他做一个mask处理，也就是通过一定的选择算法拿下面这八张图片中的一张图和这个图片按位求异或，保证黑点和白点的总体分布最均匀。</p>
<p><img src="/images/2016/09/12/1/18.png"></p>
<p>当然，我们得在二维码的格式控制区域说明我们用的是哪个掩膜，保证能够恢复。</p>
<p>这就是QR二维码直观的构造了。</p>
<p>但是即使知道了这个构造，我们也无法随意改动某个像素点，因为这些数据都是经过精心处理的，我们首先得知道他的编码方式才能在不破坏编码信息的基础上寻找修改点阵的办法。</p>
<p>事实上QR二维码对数据采用的是Reed-Solomon编码，具体细节在<a href="/2016/09/11/1/">之前的文章</a>里有所介绍。简单的理解就是他把数据块$(d_1,d_2,d_3,…,d_n)$变成了$(d_1,d_2,d_3,…,d_n,c_1,c_2,…,c_m)$，增加了具有容错能力的冗余码。显然，我们只能直接操控数据，而不能直接决定冗余码。那么我们该怎么修改数据才能既保证数据意义不变，又显示期望的图案呢？这就用到了一个小trick。</p>
<p>我们知道QR二维码基本是用来表示URL的，而URL有个特点，就是可以任意添加锚点(#)而不影响显示的结果，比如<a target="_blank" rel="noopener" href="https://blog.mythsman.com/">https://blog.mythsman.com</a>和<a target="_blank" rel="noopener" href="https://blog.mythsman.com/#this_is_junk">https://blog.mythsman.com#this_is_junk</a>，这两个url在显示的时候是完全没有区别的。也就是说只要数据是url，我们就可以在他后面添加‘#’再加上任意的数据来控制二维码的图形。这样一来，经过编码后的数据就变成了三部分：开头是原始数据加上’#’符号，中间是我们用来绘图的数据，最后是校验数据块。对于图片而言就是两头是不可控的数据，中间是可控的数据。这样弄完之后，可以呈现的效果大概是这样：</p>
<p><img src="/images/2016/09/12/1/19.png"></p>
<p>可以很明显看到中间的图片显示的很清楚，只是两边都看不清。</p>
<p>可是这种图看上去还是太生硬了，很明显就是刻意修改的数据嘛。不过还好，我们还有另一个办法让他看上去更自然。</p>
<p>回顾下之前的Reed-Solomon编码，我们知道若将$b_1,b_2$的RS编码后的值$c_1,c_2$进行异或得到$c_3$，那么这个$c_3$恰好就是$b_1,b_2$异或后的值的RS编码。这样我们就可以在保证编码合法的情况下对数据矩阵进行初等变换。原本我们只能操作整个数据中间的区域，可是经过初等变换(也就是高斯约旦消元)之后，我们就可以把能够操作的区域和不能操作的区域进行混合，这样就能把图像的控制区域放大，只是这样会牺牲图像的清晰度。不过这种图像却会给人一种自然朦胧的感觉，还是非常炫的。</p>
<p><img src="/images/2016/09/12/1/20.png"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="http://coolshell.cn/articles/10590.html">二维码的生成细节和原理</a><br><a target="_blank" rel="noopener" href="http://www.21ic.com/app/ce/201301/157718.htm">二维码 QR码编码原理详解</a><br><a target="_blank" rel="noopener" href="http://research.swtch.com/qart">QArt Codes</a><br><a target="_blank" rel="noopener" href="http://36kr.com/p/35225.html">令人拍案叫绝的15个二维码</a><br><a target="_blank" rel="noopener" href="http://36kr.com/p/204804.html">百度加入二维码之争，推出静态图像版、动态gif版“梦幻二维码”</a><br><a target="_blank" rel="noopener" href="http://baike.baidu.com/view/132241.htm">百度百科-二维码</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/11/%E4%BC%BD%E7%BD%97%E5%8D%8E%E5%9F%9F%E6%80%A7%E8%B4%A8%E7%AE%80%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/11/%E4%BC%BD%E7%BD%97%E5%8D%8E%E5%9F%9F%E6%80%A7%E8%B4%A8%E7%AE%80%E6%9E%90/" itemprop="url">伽罗华域性质简析</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-11T15:08:46+00:00">
                2016-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Maths/" itemprop="url" rel="index">
                    <span itemprop="name">Maths</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>伽罗华域名字听起来挺酷的，其实就是有限域。域这个东西由于他能够进行满足加减乘除四则运算，在加密解密、编码解码当中应用非常广泛。但是我们常见的实数域却无法直接在计算机中精确的保存，因此有限域这类能够支持四则运算而且能够用有限的编码精确保存的东西就非常有用了。</p>
<h2 id="域"><a href="#域" class="headerlink" title="域"></a>域</h2><p>域的定义在各种与离散数学相关的地方都能看到，看上去定义的十分啰嗦，说白了其实就是从有理数抽象出来的一种集合，能加能减能乘能除，满足各种四则运算律。普通的域没啥特别之处，感觉实际上用处不大。</p>
<h2 id="有限域-GF-域、伽罗华域"><a href="#有限域-GF-域、伽罗华域" class="headerlink" title="有限域($GF$域、伽罗华域)"></a>有限域($GF$域、伽罗华域)</h2><p>有限域的性质相比域来说就诱人多了，除了域的通用特点外，他还能够将所有运算的值在有限的数位内表示出来。这对数的保存而言特别有利。 常见的有限域当然就是模素数域了，比如模7域$GF(7)&#x3D;\{0,1,2,3,4,5,6\}$，这类域能够生成阶数为指定素数的域。但是很多情况下，我们需要域的阶数不是一个素数，而是一个类似于$2^n$之类的数，比如一个字节的大小$2^8$，如果能把这个范围的数用一个域来映射，那对很多计算是特别有帮助的。在要求不严格的情况下，我们当然可以弃掉一些信息，截取一个小一点的素数，比如对于256来说，我们可以选择251，来构成模251域。不过毕竟信息有丢失，我们需要一个更加方便安全的方法。</p>
<h2 id="GF-2-n-域"><a href="#GF-2-n-域" class="headerlink" title="$GF(2^n)$域"></a>$GF(2^n)$域</h2><p>这个域的出现解决了上面的问题，他的阶数恰巧适应了二进制表示，比如常见的$GF(2^8)$就能正好表示一个字节的数。他的基本思想就是把数字映射到一个多项式，把他的四则运算变成多项式之间特殊的四则运算。</p>
<h3 id="映射方法"><a href="#映射方法" class="headerlink" title="映射方法"></a>映射方法</h3><p>对于$GF(2^8)$来说，一个8bit的二进制数就直接按照各个位上的值依次放在$x^i$的系数上(显然这个多项式各个位上的系数只能是0或1)。比如5的二进制表示是101，那么他对应的多项式就是$x^2+1$。</p>
<h3 id="多项式计算"><a href="#多项式计算" class="headerlink" title="多项式计算"></a>多项式计算</h3><p>多项式的计算是问题解决的核心，普通的多项式以及正常的四则运算显然不是一个域。为了保证多项式能够构成域，我们特地设计了下面的运算。</p>
<p>正如整数集合不能构成域，但是模素数集合却能构成域一样。普通的多项式不能构成域，但是模素数多项式却能构成域。所谓的素数多项式，就是指不能被因式分解的多项式，这么设计的理由跟模素数域中选用素数的理由一样。对于$GF(2^8)$，素数多项式的最高项一定是8次，至于低次位的是多少我们并不在意。这个素多项式，我们叫做本源多项式。</p>
<p>加减运算：这上面定义的加减运算就是各个位的系数进行异或操作，显然加法跟减法是一个意思。</p>
<p>乘除运算：如果按照加减法的定义直接进行乘除运算的话会比较麻烦，通常的做法是用逆元表进行计算。我们知道有限域的生成元g可以直接用其自身的幂表示整个$GF(2^n)$域，那么域中的每个元素都可以表示成$g^i$。我们可以根据生成元g轻松确定这个i，那么他的逆元就是$g^(n-i)$。这样我么就可以打一个逆元的表，若要求$a*b$，我们直接去求$(a^{-1}*b^{-1})^{-1}$即可，只要查三次表。</p>
<p>当然，在具体的运算过程中还有很多细节可以优化，比如乘法过程可以用异或和位移运算来加速等等。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="http://research.swtch.com/field">Finite Field Arithmetic and Reed-Solomon Coding</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/luotuo44/article/details/41645597">有限域GF(2^8)的四则运算及拉格朗日插值</a><br><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_4572df4e01019wsj.html">DataMatrix编码2——伽罗华域运算</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/11/Reed-Solomon%E7%BA%A0%E5%88%A0%E7%A0%81%E7%AE%80%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/11/Reed-Solomon%E7%BA%A0%E5%88%A0%E7%A0%81%E7%AE%80%E6%9E%90/" itemprop="url">Reed-Solomon纠删码简析</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-11T11:06:44+00:00">
                2016-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Maths/" itemprop="url" rel="index">
                    <span itemprop="name">Maths</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Reed-Solomon编码（又叫RS编码、里德-所罗门编码）作为一种前向纠错编码，是一种很常见的数据冗余技术，也就是通过对数据增加冗余部分来保证当数据丢失时能够在一定程度上进行恢复。最典型的应用就是在现在最流行的QR二维码的编码设计中。</p>
<h2 id="实现功能"><a href="#实现功能" class="headerlink" title="实现功能"></a>实现功能</h2><p>他所解决的问题是：给定$n$个数据块$(d_1,d_2,d_3,…,d_n)$，对于一个确定的正整数$m$， RS编码能够根据这$n$个数据块生成$m$个校验块， $(c_1, c_2,…, c_m)$。  我们能够做到，从这$m+n$个数据(或校验)块中任取$n$块就能解码出原始数据。 即对于$n$个数据块进行RS编码后生成的$n+m$个数据块，我们能够容忍丢失至多$m$个数据块。</p>
<h2 id="编码原理"><a href="#编码原理" class="headerlink" title="编码原理"></a>编码原理</h2><p>实现的功能听上去很强大，其实原理却十分简单，只是他很巧妙的运用了矩阵运算的特点，说起来也十分简单。</p>
<p>一、对于需要进行冗余处理的$n$个数据块，我们把他写成列向量的形式，其中每个数据块都可以看做是一个数。</p>
<p>二、生成一个变换矩阵，这个矩阵由$n+m$行和$n$列组成，其中上面的$n\times n$的部分是一个单元矩阵，下面的$m\times n$的部分是一个范德蒙矩阵。</p>
<p>三、用这个变换矩阵左乘数据列向量得到$n+m$位冗余码列向量。</p>
<p>算式如下：</p>
<p>$$\begin{bmatrix}1&amp;0&amp;..&amp;0&amp;0\\0&amp;1&amp;..&amp;0&amp;0\\..&amp;..&amp;..&amp;..&amp;..\\0&amp;0&amp;..&amp;1&amp;0\\0&amp;0&amp;..&amp;0&amp;1\\1^0&amp;1^1&amp;..&amp;1^{n-2}&amp;1^{n-1}\\2^0&amp;2^1&amp;..&amp;2^{n-2}&amp;2^{n-1}\\..&amp;..&amp;..&amp;..&amp;..\\ (m-1)^0&amp;(m-1)^1&amp;..&amp;(m-1)^{n-2}&amp;(m-1)^{n-1}\\m^0&amp;m^1&amp;..&amp;m^{n-2}&amp;m^{n-1}\end{bmatrix}\times \begin{bmatrix}b_1\\b_2\\b_3\\..\\b_n\end{bmatrix}&#x3D;\begin{bmatrix}b_1\\b_2\\b_3\\..\\b_n\\c_1\\c_2\\c_3\\..\\c_m\end{bmatrix}$$</p>
<p>上面使用单位矩阵显然是为了保证原数据块在编码后不发生变化，从而看上去只是增加了冗余码。</p>
<p>下面使用范德蒙矩阵其实是为了保证这个矩阵任取$n*n$的部分可逆。</p>
<h2 id="解码原理"><a href="#解码原理" class="headerlink" title="解码原理"></a>解码原理</h2><p>根据上面的编码方式，我们可以很容易理解他的解码方法。对于编码后的数据块$(b_1,b_2,…,b_n,c_1,c_2,…,c_m)$，只需要任取其中的$m$个数据块，假设为$(b_{a_1},b_{a_2},…,b_{a_x},c_{b_1},c_{b_2},…,c_{b_y})$其中$x+y&#x3D;m$，再用$f_i$表示编码过程中那个矩阵的第$i$行。显然，下面的等式一定成立：<br>$$\begin{bmatrix}f_{a_1}\\f_{a_2}\\..\\f_{a_x}\\f_{n+b_1}\\f_{n+b_2}\\..\\f_{n+b_y}\end{bmatrix}\times\begin{bmatrix}b_1\\b_2\\b_3\\..\\b_n\end{bmatrix}&#x3D;\begin{bmatrix}b_{a_1}\\b_{a_2}\\…\\b_{a_x}\\c_{b_1}\\c_{b_2}\\…\\c_{b_y}\end{bmatrix}$$</p>
<p>这样一来，我们就可以把中间的数据矩阵解出来了。</p>
<h2 id="计算域"><a href="#计算域" class="headerlink" title="计算域"></a>计算域</h2><p>上面的方法理论上是能够做到数据冗余处理的，不过由于作为一种编码技术，RS编码需要处理的是特定长度的二进制数据，然而求矩阵逆的过程是在实数域内进行的。显然特定长度的二进制位是无法准确描述实数的。因此RS编码的计算域采用的是能够用二进制位精确编码的伽罗华域$GF(2^n)$。这个域的特性就是非常适合处理$[0-2^n)$范围内数据的四则运算，而且这里的四则运算大都通过位运算处理，效率比较高。实际生产中由于数据的量会比较大，为了加快整个计算的过程，通常会采用离散傅里叶变换(DFT)及其逆变换来进行编码实现。具体的介绍可以参见<a target="_blank" rel="noopener" href="http://blog.mythsman.com/?p=3135">这一篇文章</a>。</p>
<h2 id="重要特征"><a href="#重要特征" class="headerlink" title="重要特征"></a>重要特征</h2><p>由于RS编码采用的是伽罗华域$GF(2^n)$，那他就有一个很有趣的特点，那就是对于数据$b_1,b_2$以及其分别对应的冗余码$c_1,c_2$，我们可以迅速的知道对于数据$b_1\otimes b_2$，他的冗余码就是$c_1\otimes c_2$($\otimes $表示异或)。</p>
<p>这一点其实很好理解，根据之前的编码过程，我们很容易知道对于实数域，如果数据$b_1,b_2$分别对应的冗余码是$c_1,c_2$，那么数据$b_1+ b_2$的冗余码就是$c_1+ c_2$。而现在的运算域是伽罗华域，在伽罗华域中加法做的就是异或操作。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="http://peterylh.blog.163.com/blog/static/12033201371375050233/">Reed Solomon纠删码</span></a><br><a target="_blank" rel="noopener" href="http://www.eetop.cn/blog/html/71/63271-2747.html">里德-所罗门码(RS 码) 简介</a><br><a target="_blank" rel="noopener" href="http://research.swtch.com/field">Finite Field Arithmetic and Reed-Solomon Coding</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.resonanat.com/2016/09/09/%E5%B9%82%E5%AE%9A%E5%BE%8B%E5%92%8C%E9%BD%90%E5%A4%AB%E5%AE%9A%E5%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Resive world">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/09/%E5%B9%82%E5%AE%9A%E5%BE%8B%E5%92%8C%E9%BD%90%E5%A4%AB%E5%AE%9A%E5%BE%8B/" itemprop="url">幂定律和齐夫定律</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-09T14:27:33+00:00">
                2016-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data-Mining/" itemprop="url" rel="index">
                    <span itemprop="name">Data Mining</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="幂定律"><a href="#幂定律" class="headerlink" title="幂定律"></a>幂定律</h2><p>幂定律又叫幂律，大量的事实表明，很多现象都服从类似于幂函数$y&#x3D;cx^a$的形式，其中$a$是幂，而且通常是负数。</p>
<p>幂定律可以非常直观的用马太效应(Matthew effect)解释，说白了其实就是所谓的“富者越富，穷者越穷”。例如图书的销售，本来销售好的图书可能会发布更多的广告，做更多的营销从而导致销量更多。这样如果将图书销售量按照名次排列下来就会发现图书销量会随着名次的提高而指数性的提高。</p>
<h2 id="齐夫定律"><a href="#齐夫定律" class="headerlink" title="齐夫定律"></a>齐夫定律</h2><p>齐夫定律(Zipf’s Law)其实可以说是幂定律的一种形式，只是由于在曾经一次语料库的统计分析中由于拟合效果很好而广为人知。简而言之，他的内容就是对于一个语料库而言，我们统计他当中每一个词$i$出现的频率$f_i$与该频率在所有的词语中间的排名$r_i$，发现$f_i\times r_i$竟然近似等于一个常数$C$。当然，这只是一个经验定律，并不是定理、更不是理论。不过在自然界中有很多现象都满足这样一条规律而已。</p>
<p>不过这个定律的具体形式也不仅仅局限于上面的那个等式，而是有可能会变成$f_i\times r_i^\alpha &#x3D;C$等等一系列形式。毕竟只是一个经验公式，拟合的时候相应的调节下参数也不是不可。</p>
<h2 id="齐夫定律的简单应用"><a href="#齐夫定律的简单应用" class="headerlink" title="齐夫定律的简单应用"></a>齐夫定律的简单应用</h2><p>除了拟合预测，齐夫定律还有一个很有用的应用，就是在之前的一个实验中，我需要在某个城市的地图上上随机生成一些点来模拟人的位置，那么我该如何模拟更加真实呢？现实生活中人肯定不会是标准均匀分布的，如果使用正态分布的话，所有人都是以一个点为中心分布似乎也不太合理。这是就可以用到这个齐夫定律了。我们可以先假定总共有$N$个人，我们可以把人这些人分为$m$个人群，每个人群都是以二维正态分布的方式(选择好方差)聚集在中心点周围，而中心点可以以随机分布的方式从图中直接获取。至于每个人群的人数，我们可以按照齐夫定律，选择每个人群的个数。选择的方法也很简单，假设第$i$个人群的人数是$a_i$，解下面的方程组即可：<br>$$\left\{\begin{aligned}&amp;\sum a_i&#x3D;N\\&amp;i*a_i&#x3D;j*a_j\end{aligned}\right.$$</p>
<p>这样最后生成的随机分布就非常具有说服力了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/31/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><span class="space">&hellip;</span><a class="page-number" href="/page/51/">51</a><a class="extend next" rel="next" href="/page/33/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">507</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">66</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">255</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Companyd</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
